{% extends "enterprise/layout.html" %}

{% block enterprise_content %}
<div class="ent-section">
    <div class="section-header">
        <h3>Revenue</h3>
        {% if revenue_list %}
        <span style="font-size:1.1rem; font-weight:700; color:#16a34a;">
            Total:&nbsp;{{ currency }}{{ "%.2f"|format(revenue_list|sum(attribute='amount')|float) }}
        </span>
        {% endif %}
    </div>

    <!-- Period and Firm Filter Bar -->
    <div
        style="display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap; margin-bottom:1.5rem; justify-content: space-between;">
        <div style="display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap;">
            <a href="?period=this_year{% if selected_firm %}&firm={{ selected_firm }}{% endif %}"
                class="period-pill {% if period == 'this_year' %}active{% endif %}">This Year</a>
            <a href="?period=this_month{% if selected_firm %}&firm={{ selected_firm }}{% endif %}"
                class="period-pill {% if period == 'this_month' %}active{% endif %}">This Month</a>
            <a href="?period=this_week{% if selected_firm %}&firm={{ selected_firm }}{% endif %}"
                class="period-pill {% if period == 'this_week' %}active{% endif %}">This Week</a>
            <a href="?period=custom{% if selected_firm %}&firm={{ selected_firm }}{% endif %}"
                class="period-pill {% if period == 'custom' %}active{% endif %}">Custom</a>
            {% if period == 'custom' %}
            <form method="get" style="display:flex; align-items:center; gap:0.5rem; margin-left:0.25rem;">
                <input type="hidden" name="period" value="custom">
                {% if selected_firm %}
                <input type="hidden" name="firm" value="{{ selected_firm }}">
                {% endif %}
                <input type="date" name="start_date" value="{{ start_date or '' }}" class="form-control"
                    style="width:auto;">
                <span style="color:var(--text-tertiary);">to</span>
                <input type="date" name="end_date" value="{{ end_date or '' }}" class="form-control"
                    style="width:auto;">
                <button type="submit" class="btn-primary" style="padding:0.4rem 1rem;">Apply</button>
            </form>
            {% endif %}
        </div>

        <div style="display:flex; align-items:center; gap:0.5rem;">
            <label style="font-size: 0.8rem; font-weight: 600; color: var(--text-secondary);">Firm:</label>
            <select name="firm" class="form-control" style="width: auto; padding: 0.35rem 0.75rem; font-size: 0.85rem;"
                onchange="
                const urlParams = new URLSearchParams(window.location.search);
                urlParams.set('firm', this.value);
                window.location.search = urlParams.toString();
            ">
                <option value="All" {% if selected_firm=='All' %}selected{% endif %}>All Firms</option>
                {% for f in firms_list %}
                <option value="{{ f.name }}" {% if selected_firm==f.name %}selected{% endif %}>{{ f.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Table -->
    <div class="reports-table-wrapper">
        <table class="reports-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Category</th>
                    <th>Taken By</th>
                    <th>Narrative</th>
                    <th style="text-align:right;">Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for item in revenue_list %}
                <tr>
                    <td>{{ item.date }}</td>
                    <td><span class="badge badge-success" style="font-size:0.75rem;">Income</span></td>
                    <td>{{ item.category or '—' }}</td>
                    <td>{{ item.taken_by_name or item.taken_by or '—' }}</td>
                    <td style="color:var(--text-secondary);">{{ item.narrative or item.description or '—' }}</td>
                    <td style="text-align:right; font-weight:600; color:#16a34a;">{{ currency }}{{
                        "%.2f"|format(item.amount|float) }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align:center; color:var(--text-tertiary); padding:2rem 0;">
                        No revenue records found for this period.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}